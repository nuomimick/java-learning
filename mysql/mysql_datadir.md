# Mysql的数据目录

数据目录：Mysql服务器程序在启动时会到文件系统的某个目录下加在一些文件，之后在运行过程中产生的数据也都会存储到这个目录下的某些文件中，这个目录就是**数据目录**。

查看数据目录：`SHOW VARIABLES LIKE 'datadir';`

**数据库在文件系统中的表示**  
每个数据库都对应数据目录下的一个子目录，或者说对应一个文件夹。每次新建一个数据库时，mysql会做两件事情：
1. 在数据目录下创建一个和数据库名同名的子目录（或者说文件夹）
2. 在该与数据库同名的子目录下创建一个名为`db.opt`的文件，这个文件中包含了该数据库的各种属性，比方说该数据库的字符集和比较规则是个啥。

**表在文件系统中的表示**
1. 表结构的定义  
    会在对应的数据库子目录下创建一个专门用于描述表结构的文件，文件名是`表名.frm`
2. 表中的数据  
    不通的存储引擎保存的方式不一样

>InnoDB是如何存储表数据的  
InnoDB使用页为基本单位来管理存储空间，默认的页大小为16KB。为了更好的管理这些页，InnoDB有一个表空间或者文件空间的概念。这个表空间是一个
抽象的概念，它可以对应文件系统上一个或者多个的真实文件（不同表空间对应的真实文件的数据可能不同）。每一个表空间可以被划分为很多很多很多个页，
表数据就存储在页中。  
表空间划分为如下几种不同的类型：
>1. 系统表空间  
    默认情况下，InnoDB会在数据目下创建一个名为ibdata1、大小为12M的文件。  
    `修改启动时配置，自定义文件路径和大小：innodb_data_file_path=data1:512M;data2:512M:autoextend`
    这样在mysql启动之后就会创建者两个512M大小的文件作为系统表空间，其中`autoextend`表明这两个文件如果不够用会自动扩展data2文件的大小。  
    注意：在一个Mysql服务器中，系统表空间只有一份。从**Mysql5.5.7到5.6.6之间的各个版本中**，表中的数据默认存储到这个系统表空间中。
>2. 独立表空间
    在Mysql5.6.6以及之后的版本中，InnoDB会为每一个表创建一个独立表空间`表名.ibd`。  
    表空间被划分为许多连续的区（物理位置上连续的64个页），每个区默认有64个页面组成（1M），每256个区划分为一组。每个组最开始的几个页面类型是固定的。为了进行范围查询的时候可以使用顺序I/O，才引入区的设计。存放区的集合被称为段。  
    为了提高范围扫描的效果，叶子节点和非叶子节点独立存在在不同的区。也就是说一个索引会生成2个段，一个叶子节点段，一个非叶子节点段。  
    但是如果表数据很少的话，就会造成很大的空间浪费（两个段，每个段一个区，一个区默认大小为1M）。因此InnoDB有碎片区的概念。碎片区的页可以用于不同的段。碎片区只属于表空间，并不属于任意一个段。
    此后，为某个段分配存储空间的策略是这样的：  
    a) 在刚开始向表中插入数据的时候，段是从某个碎片区以单个页面为单位来分配存储空间的。  
    b) 当某个段已经占用了32个碎片区页面之后，就会以完整的区为单位来分配存储空间。  
    因此，段是一些零散的页面和一些完整的区的集合。  
    这些区大体上可分为空间的区（FREE）、有剩余空间的碎片区（FREE_FRAG）、没有剩余空间的碎片区（FULL_FRAG）、FSEG（附属于某个段的区）。为了管理这些区，InnoDB设计了`XDES Entry`的结构。
>3. 其他类型的表空间  
>
>MyISAM引擎  
MyISAM的索引都是二级索引，且数据和索引是分开存放的。MyISAM并没有什么所谓的表空间，表数据都是存放到对应的数据库子目录下。比如test表在数据库对应的目录下会创建这三个文件：
`test.frm，test.MYD，test.MYI`    
test.MYD表示数据文件，test.MYI表示索引文件

视图在文件系统中的表示  
因为视图是虚拟的表，所以在存储视图的时候是不需要存储真实的数据的，只需要存储它的结构存储就行了。因此，视图会在数据库目下创建一个`视图名.frm`的文件。

除此之外，数据目录还包括一些额外文件：服务器进程文件、服务器日志文件、默认/自动生成的SSL和RSA证书和秘钥文件。

Mysql系统数据库简介  
1. mysql
    存储了Mysql的用户账号和权限信息，一些存储过程、事件的定义信息，一些运行过程中产生的日志信息，一些帮助信息以及时区信息等。
2. information_schema
    保存着Mysql服务器维护的所有其他数据库的信息，比如有哪些表、哪些视图、哪些触发器、哪些列、哪些索引等。
3. performance_schema
    保存Mysql服务器运行过程中的一些状态信息，算是对Mysql服务器的一个性能监控。包括统计最近执行了哪些语句，在执行过程的每个阶段都花费了多长时间，内存的使用情况等信息。
4. sys
    这个数据库主要是通过视图的形式把information_schema和performance_schema结合起来，让程序员可以更方便的了解Mysql服务器的一些性能信息。
